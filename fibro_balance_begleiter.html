<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fibro Balance Begleiter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card {
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* Fully rounded buttons */
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .symptom-checkbox {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border: 1px solid;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.2s;
        }

        /* Light Mode */
        body.light {
            background-image: linear-gradient(135deg, #f0f9ff, #b8e9f5); /* Very light, soft blue gradient */
            color: #333;
        }
        .light .container {
            background-color: #ffffff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .light .card {
            background-color: #f7faff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .light .symptom-checkbox {
            background-color: #ffffff;
            border-color: #a8d8e0;
        }
        .light .symptom-checkbox.checked {
            background-color: #4ac7c7;
            border-color: #2e9b9b;
            color: #fff;
        }
        .light .btn-primary {
            background-color: #4ac7c7;
            color: #fff;
        }
        .light .btn-primary:hover {
            background-color: #2e9b9b;
        }
        .light .btn-secondary {
            background-color: #e2e8f0;
            color: #4b5563;
        }
        .light .btn-secondary:hover {
            background-color: #cbd5e1;
        }
        .light .insights-box {
            background-color: #e0f2f1;
            color: #0f766e;
        }
        
        /* Dark Mode */
        body.dark {
            background-image: linear-gradient(135deg, #011f26, #004d60); /* Deep, but soft blue-green gradient */
            color: #e2e8f0;
        }
        .dark .container {
            background-color: #003340;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .dark .card {
            background-color: #004d60;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .dark .symptom-checkbox {
            background-color: #003340;
            border-color: #4ac7c7;
            color: #e2f8ff;
        }
        .dark .symptom-checkbox.checked {
            background-color: #4ac7c7;
            border-color: #2e9b9b;
            color: #011f26;
        }
        .dark .btn-primary {
            background-color: #4ac7c7;
            color: #fff;
        }
        .dark .btn-primary:hover {
            background-color: #2e9b9b;
        }
        .dark .btn-secondary {
            background-color: #2d3748;
            color: #cbd5e1;
        }
        .dark .btn-secondary:hover {
            background-color: #4a5568;
        }
        .dark .insights-box {
            background-color: #006666;
            color: #e2f8ff;
        }

        /* Toggle Button */
        #themeToggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
        }
        .insights-loading {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>
<body class="light">

    <div id="themeToggle" onclick="toggleTheme()">☀️</div>

    <div class="container">
        <h1 class="text-3xl font-bold text-center mb-2">Fibro Balance Begleiter</h1>
        <p class="text-center text-sm mb-8">Dein tägliches Tool für Achtsamkeit und Energieverwaltung.</p>
        
        
        <!-- Willkommens-Sektion -->
        <div class="card bg-gray-50 dark:bg-gray-700">
            <h2 class="text-2xl font-semibold mb-2">Willkommen</h2>
            <p class="text-sm mb-4">Fibromyalgie ist eine Krankheit, bei der die Symptome oft unsichtbar sind und die Energie von Tag zu Tag stark schwanken kann. Dieser Begleiter hilft dir, deine tägliche Energie (deine "Löffel") zu verwalten und Muster in deinen Symptomen zu erkennen. Du bist nicht allein.</p>
            <p class="text-sm font-semibold text-right">Beginne, indem du deine heutigen Symptome und Löffel notierst.</p>
        </div>

        <!-- Symptom- und Löffel-Tracking-Bereich -->
        <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Dein Tag heute</h2>
            <div class="mb-4">
                <label class="block font-medium mb-2">Welche Symptome spürst du heute?</label>
                <div class="flex flex-wrap gap-2" id="symptomCheckboxes">
                    <!-- Checkboxes will be generated here -->
                </div>
            </div>

            <div class="mb-6">
                <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg text-sm mb-2">
                    <p>Die Löffeltheorie erklärt, dass deine Energie begrenzt ist. Jeder <b>Löffel</b> steht für eine Einheit Energie, die du verbrauchst.</p>
                    <p class="mt-2">Eine niedrige Zahl (z.B. <b>1</b> oder <b>2</b>) ist gut. Eine hohe Zahl bedeutet, dass du viel Energie verbraucht hast und vielleicht eine Pause brauchst.</p>
                </div>
                <label for="spoons" class="block font-medium mb-2">Wie viele Löffel hast du heute verbraucht?</label>
                <input type="number" id="spoons" min="0" placeholder="Z. B. 6"
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow">
            </div>

            <button onclick="logData()" class="btn w-full btn-primary">Daten speichern</button>
        </div>

        <!-- KI-gesteuerte Einblicke -->
        <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Intelligente Einblicke</h2>
            <p class="text-sm mb-4">Basierend auf deinen Daten erstellt die KI eine personalisierte Zusammenfassung deines Tages.</p>
            <button onclick="generateInsights()" class="btn w-full btn-primary">Einblicke erstellen</button>
            <div id="insightsOutput" class="mt-4 p-4 rounded-lg insights-box hidden"></div>
        </div>

        <!-- Video-Übungen -->
        <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Übungen</h2>
            <p class="text-sm mb-4">Wähle deine Symptome, um passende Übungen zu sehen, die dir helfen, deinen Körper zu unterstützen. Denke immer an Pacing, beginne behutsam und höre auf deinen Körper!</p>
            
            <!-- Dynamisch generierte Übungen -->
            <div id="exercisesContainer" class="space-y-4"></div>

        </div>

        <!-- Neue Sektion: Lösungsansätze -->
        <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Lösungsansätze & Tipps</h2>
            <p class="text-sm mb-4">Hier sind einige Ansätze, die dir helfen können, deine Symptome zu lindern und deine Lebensqualität zu verbessern.</p>

            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-2">Pacing & Energiewirtschaft</h3>
                <p class="text-sm">Das richtige Einteilen deiner Energie ist entscheidend. Plane deine Aktivitäten und Ruhephasen im Voraus, um eine Überanstrengung zu vermeiden. Lerne, auf die Signale deines Körpers zu hören.</p>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-2">Stressmanagement</h3>
                <p class="text-sm">Chronischer Stress kann Symptome verschlimmern. Techniken wie <b>Atemübungen, Meditation oder Progressive Muskelentspannung</b> können helfen, den Körper zu beruhigen und die Schmerzwahrnehmung zu reduzieren.</p>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-2">Schlafhygiene</h3>
                <p class="text-sm">Guter Schlaf ist essenziell für die Erholung. Achte auf feste Schlafenszeiten, sorge für ein ruhiges Schlafumfeld und vermeide Koffein sowie große Mahlzeiten vor dem Schlafengehen.</p>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-2">Bewegung & Physiotherapie</h3>
                <p class="text-sm">Sanfte Bewegung, wie sie auch in den Übungen vorgeschlagen wird, ist wichtig. <b>Tai Chi, Yoga, Schwimmen oder Spazierengehen</b> können helfen, die Muskulatur zu stärken und Schmerzen zu lindern, ohne den Körper zu überfordern. Auch <b>Wärmeanwendungen</b> wie Bäder oder eine Wärmflasche können wohltuend sein.</p>
            </div>
            
        </div>

        <!-- Neue Sektion: Hilfsangebote -->
        <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Hilfsangebote in deiner Nähe</h2>
            <p class="text-sm mb-4">Finde Selbsthilfegruppen, Therapiezentren oder Physiotherapeuten, die auf Fibromyalgie spezialisiert sind.</p>
            <div class="flex items-center gap-2 mb-4">
                <input type="text" id="plzInput" maxlength="5" placeholder="PLZ eingeben"
                    class="flex-grow px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow">
                <button onclick="findHelp()" class="btn btn-primary">Suchen</button>
            </div>
            <div id="helpResults" class="hidden">
                <h3 class="text-lg font-semibold mb-2">Ergebnisse für <span id="plzResult"></span></h3>
                <ul class="space-y-2 text-sm">
                    <li><strong class="font-medium">Deutsche Rheuma-Liga e.V.</strong> - Selbsthilfegruppe vor Ort (<a href="https://www.rheuma-liga.de/beratung-und-service/selbsthilfegruppen" target="_blank" class="text-blue-500 hover:underline">Link</a>)</li>
                    <li><strong class="font-medium">Therapiezentrum "Neue Wege"</strong> - Physiotherapie & Schmerztherapie</li>
                    <li><strong class="font-medium">Praxis Dr. Müller</strong> - Rheumatologie & Schmerztherapie</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Custom Modal -->
    <div id="modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full shadow-xl dark:bg-gray-800 dark:text-gray-100">
            <div id="modalContent" class="text-center"></div>
            <div class="flex justify-center mt-4">
                <button onclick="closeModal()" class="btn btn-secondary">Schließen</button>
            </div>
        </div>
    </div>

    <script>
        // Global state for the application
        let dailyData = {
            symptoms: [],
            spoons: null,
        };

        // --- DOM Elements ---
        const modalEl = document.getElementById('modal');
        const modalContentEl = document.getElementById('modalContent');
        const exercisesContainerEl = document.getElementById('exercisesContainer');
        const symptomCheckboxesContainerEl = document.getElementById('symptomCheckboxes');
        const themeToggleEl = document.getElementById('themeToggle');
        const insightsOutputEl = document.getElementById('insightsOutput');
        const plzInputEl = document.getElementById('plzInput');
        const helpResultsEl = document.getElementById('helpResults');
        const plzResultEl = document.getElementById('plzResult');
        const spoonsInputEl = document.getElementById('spoons');

        // --- Theme Toggling ---
        // Initial theme setting based on system preference
        function initializeTheme() {
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark');
                themeToggleEl.textContent = '🌙';
            } else {
                document.body.classList.add('light');
                themeToggleEl.textContent = '☀️';
            }
        }
        
        function toggleTheme() {
            if (document.body.classList.contains('light')) {
                document.body.classList.remove('light');
                document.body.classList.add('dark');
                themeToggleEl.textContent = '🌙';
            } else {
                document.body.classList.remove('dark');
                document.body.classList.add('light');
                themeToggleEl.textContent = '☀️';
            }
        }

        // --- Custom Modal Functions ---
        function showMessage(message) {
            modalContentEl.innerHTML = `<p>${message}</p>`;
            modalEl.classList.remove('hidden');
        }

        function closeModal() {
            modalEl.classList.add('hidden');
        }

        // --- Data Definitions ---
        const ALL_SYMPTOMS = [
            "Muskel- & Gelenkschmerzen",
            "Müdigkeit & Erschöpfung (Fatigue)",
            "Schlechter Schlaf",
            "Kopfschmerzen & Migräne",
            "Verdauungsprobleme",
            "Herzrasen & Atemnot",
            "Gefühlsstörungen (Kribbeln, Taubheit)",
            "Überempfindlichkeit (Lärm, Licht, Berührung)",
            "Konzentrations- & Gedächtnisstörungen",
            "Emotionaler Stress & Unruhe"
        ];

        const exercises = [
            {
                title: "Sanfter Spaziergang",
                description: "Leichtes Ausdauertraining, um Schmerzen zu verringern und die Muskulatur zu lockern.",
                videoUrl: "https://www.youtube.com/watch?v=FjI5jYt7G9I",
                relatedSymptoms: ["Muskel- & Gelenkschmerzen", "Müdigkeit & Erschöpfung (Fatigue)"]
            },
            {
                title: "Progressive Muskelentspannung",
                description: "Eine Entspannungsübung, um Stress zu reduzieren und die Anspannung im Körper zu lösen.",
                videoUrl: "https://www.youtube.com/watch?v=4T1j5-Tf7nE",
                relatedSymptoms: ["Emotionaler Stress & Unruhe", "Schlechter Schlaf"]
            },
            {
                title: "Tai Chi für Anfänger",
                description: "Sanfte, fließende Bewegungen, die die Gelenke schonen und die Konzentration fördern.",
                videoUrl: "https://www.youtube.com/watch?v=yYJ4hT_sJek",
                relatedSymptoms: ["Muskel- & Gelenkschmerzen", "Konzentrations- & Gedächtnisstörungen", "Müdigkeit & Erschöpfung (Fatigue)"]
            },
            {
                title: "Atemübung gegen Unruhe",
                description: "Eine einfache Atemtechnik, um das Nervensystem zu beruhigen und Herzrasen zu kontrollieren.",
                videoUrl: "https://www.youtube.com/watch?v=8fkYm-n3o8k",
                relatedSymptoms: ["Herzrasen & Atemnot", "Emotionaler Stress & Unruhe"]
            },
            {
                title: "Meditation zur Schmerzlinderung",
                description: "Fokussiere deinen Geist, um die Schmerzwahrnehmung zu beeinflussen und innere Ruhe zu finden.",
                videoUrl: "https://www.youtube.com/watch?v=ITwS51qB_2Y",
                relatedSymptoms: ["Muskel- & Gelenkschmerzen", "Kopfschmerzen & Migräne", "Emotionaler Stress & Unruhe"]
            }
        ];
        
        // --- UI Rendering Functions ---
        function renderSymptomCheckboxes() {
            symptomCheckboxesContainerEl.innerHTML = ALL_SYMPTOMS.map(symptom => `
                <label class="symptom-checkbox" data-symptom="${symptom}">
                    <input type="checkbox" class="hidden" onchange="toggleSymptom(this, '${symptom}')">
                    <span>${symptom}</span>
                </label>
            `).join('');
        }

        function toggleSymptom(checkbox, symptom) {
            const label = checkbox.closest('label');
            if (checkbox.checked) {
                dailyData.symptoms.push(symptom);
                label.classList.add('checked');
            } else {
                dailyData.symptoms = dailyData.symptoms.filter(s => s !== symptom);
                label.classList.remove('checked');
            }
            renderExercises();
        }

        function renderExercises() {
            const relevantExercises = dailyData.symptoms.length > 0 ? exercises.filter(ex => 
                ex.relatedSymptoms.some(rs => dailyData.symptoms.includes(rs))
            ) : exercises;

            if (relevantExercises.length === 0) {
                 exercisesContainerEl.innerHTML = `<p class="text-sm text-center">Wähle Symptome aus, um passende Übungen zu sehen.</p>`;
                 return;
            }

            exercisesContainerEl.innerHTML = relevantExercises.map(ex => `
                <div class="p-4 border rounded-lg flex flex-col sm:flex-row items-start sm:items-center justify-between transition-shadow hover:shadow-md">
                    <div>
                        <h3 class="font-semibold text-lg">${ex.title}</h3>
                        <p class="text-sm mt-1">${ex.description}</p>
                    </div>
                    <a href="${ex.videoUrl}" target="_blank" class="mt-4 sm:mt-0 btn btn-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                        </svg>
                        Video ansehen
                    </a>
                </div>
            `).join('');
        }

        // --- Core App Logic ---
        function logData() {
            const spoonsValue = spoonsInputEl.value;
            if (dailyData.symptoms.length > 0 && spoonsValue !== '') {
                dailyData.spoons = parseInt(spoonsValue);
                showMessage('Deine Daten wurden erfolgreich gespeichert!');
            } else {
                showMessage('Bitte wähle mindestens ein Symptom aus und gib deinen Löffelverbrauch an, um deine Daten zu speichern.');
            }
        }

        async function generateInsights() {
            insightsOutputEl.classList.remove('hidden');
            insightsOutputEl.classList.add('insights-loading');
            insightsOutputEl.innerHTML = `<p class="text-center">Analysiere deine Daten...</p>`;
            
            // Collect user data for the LLM prompt
            const userSymptoms = dailyData.symptoms.length > 0 ? dailyData.symptoms.join(', ') : "keine Symptome aufgezeichnet";
            const userSpoons = dailyData.spoons !== null ? dailyData.spoons : "keine Löffel aufgezeichnet";
            
            // Build the German-language prompt for the LLM
            const systemPrompt = `Du bist ein KI-gesteuerter Gesundheitsbegleiter, der Menschen mit Fibromyalgie unterstützt. Dein Ziel ist es, eine kurze, motivierende und verständliche Zusammenfassung des Tages zu geben.
            Analysiere die folgenden Daten:
            - Aufgezeichnete Symptome: ${userSymptoms}
            - Verbrauchte Löffel am Tag: ${userSpoons}
            Gib eine Zusammenfassung, die die Zusammenhänge zwischen den Symptomen und dem Energieverbrauch (Löffeln) hervorhebt. Gib keine medizinischen Ratschläge. Beende deine Antwort mit einem kurzen, motivierenden Satz, der den Nutzer ermutigt, weiterzumachen.`;

            // Simulate the LLM API call
            setTimeout(() => {
                let generatedText;
                if (userSymptoms === "keine Symptome aufgezeichnet" || userSpoons === "keine Löffel aufgezeichnet") {
                    generatedText = 'Bitte speichere zuerst deine Symptome und deinen Löffelverbrauch, um Einblicke zu erhalten.';
                } else if (userSpoons > 8) {
                    generatedText = `Heute hast du viel Energie verbraucht, was sich in ${userSpoons} verbrauchten Löffeln widerspiegelt. Die Symptome wie ${userSymptoms} könnten ein Hinweis darauf sein, dass es wichtig ist, sich genügend Ruhe zu gönnen.`;
                } else if (userSpoons <= 5) {
                    generatedText = `Dein niedriger Löffelverbrauch (${userSpoons}) deutet auf einen ruhigen Tag hin. Dies ist eine gute Strategie, um Symptome wie ${userSymptoms} zu bewältigen und dem Körper Zeit zur Erholung zu geben.`;
                } else {
                    generatedText = `Dein Energieverbrauch lag heute im ausgewogenen Bereich bei ${userSpoons} Löffeln. Dies ist ein guter Hinweis auf einen Tag, an dem du deine Aktivitäten gut dosieren konntest, obwohl du Symptome wie ${userSymptoms} hattest.`;
                }

                insightsOutputEl.innerHTML = `<p class="font-medium">${generatedText}</p>`;
                insightsOutputEl.classList.remove('insights-loading');
            }, 1500); // Simulate network latency
        }

        function findHelp() {
            const plzValue = plzInputEl.value;
            const plzRegex = /^\d{5}$/;

            if (plzRegex.test(plzValue)) {
                plzResultEl.textContent = plzValue;
                helpResultsEl.classList.remove('hidden');
            } else {
                showMessage("Bitte gib eine gültige 5-stellige Postleitzahl ein.");
                helpResultsEl.classList.add('hidden');
            }
        }

        // --- Initialisation ---
        window.onload = function() {
            initializeTheme();
            renderSymptomCheckboxes();
            renderExercises();
        };
    </script>
</body>
</html>
